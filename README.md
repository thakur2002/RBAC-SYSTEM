# Role-Based Access Control (RBAC) System

This project is a backend implementation of a Role-Based Access Control (RBAC) system. This application enables secure user signup, login, logout, profile management, and role-based access to various actions and endpoints.

## Setup Instructions

### 1. Clone the Repository
```bash
git clone <repository-url>
cd <repository-folder>
npm install
```
### 2. Create a .env file in the root directory with the following variables
```
MONGO_URI=<your-mongodb-uri>
JWT_SECRET=<your-secret-key>
DEFAULT_ADMIN_USERNAME=<default-admin-username>
DEFAULT_ADMIN_PASSWORD=<default-admin-password>
```

### 3. Run the Server
```bash
npm start
```
The server will start at http://localhost:givenportnumber
## Technology Stack

- Nodejs: Runtime for backend development.

- Express: Web framework for building REST APIs.
- MongoDB: NoSQL database for data storage.
- Mongoose: ODM library for MongoDB.
- JWT: Authentication via JSON Web Tokens.
- Postman: Used for testing API endpoints.

## Features
- API endpoints:
  - POST/auth/signup: Person registers
  - POST/auth/login:  Person logs in
  - POST/auth/logout: Person logs out
  - GET/user/Profile: Person views own profile
  - PUT/user/Profile: Person updates own profile
  - GET /user/users: To get profile of all users 
  - PUT /user/users/:username/:role : To update the role of the person with the  username. 

  - DELETE /user/:username/:username:  to delete the person with the username. 
- **User Registration & Login**: Users register with unique usernames and passwords. JWT tokens are generated upon login and stored securely in HTTP-only cookies.
- **Role-Based Permissions**: Three default roles with specific access permissions:
  - **Admin**:
    - View and delete any user (except other Admins).
    - Update roles of any user (except other Admins).
    - Manage their own profile.
  - **Moderator**:
    - View all users.
    - Manage their own profile.
  - **User**:
    - View and update their own profile.
- **Secure Authentication**: JWT tokens stored in HTTP-only cookies ensure secure communication.

- **Default Role & Admin**:
  - A default admin user is created with the username and password provided in the .env file. If an admin already exists, this step is skipped.
  - The application seeds default roles and the permissions assigned to them.
  - The permissions can be:
     - getAllUsers: Access to list all users.
     - updateRole: Ability to update a user's role.
     - deleteUser: Ability to delete a user.
     - getOwnProfile: Access to view own profile.
     - UpdateOwnProfile: Ability to update own profile.
  - Users are assigned the `User` role by default after registration.

- **Error Handling**: Comprehensive error messages and status codes ensure smooth operation.

---

## Data Storage

### User Collection
Each user document contains:
- **username**: Unique identifier (case-normalized at the server).
- **password**: Encrypted password using bcrypt.
- **role**: Assigned role (`Admin`, `Moderator`, `User`).
- **name**: User's name.
- **email**: Email address.
- **age**: User's age.
- **experience**: Professional experience in years.
- **_id**:A unique identifier for each document, automatically generated by MongoDB. 

### Roles Collection
Each role document includes:
- **role**: Role name (e.g., Admin, Moderator, User).
- **permissions**: Array of Access permissions for that role.
- **_id**:A unique identifier for each document, automatically generated by MongoDB. 
---

## API Endpoints

### Authentication Endpoints
1. **Sign Up**
   - **Endpoint**: `POST /auth/signup`
   - **Description**: Registers a new user with a default `User` role.
   - **Request Body**:
     ```json
     {
       "username": "peter",
       "password": "peter123"
     }
     ```
   - **Response**:
     ```json
     {
       "message": "User registered successfully!"
     }
     ```

2. **Login**
   - **Endpoint**: `POST /auth/login`
   - **Description**: Authenticates a user and sets a JWT token in an HTTP-only cookie.
   - **Request Body**:
     ```json
     {
       "username": "peter",
       "password": "peter123"
     }
     ```
   - **Response**:
     ```json
     {
       "message": "Login successful"
     }
     ```

3. **Logout**
   - **Endpoint**: `POST /auth/logout`
   - **Description**: Logs out a user and clears the cookie.
   - **Response**:
     ```json
     {
       "message": "Logged out successfully"
     }
     ```

---

### User Management Endpoints
1. **View Own Profile**
   - **Endpoint**: `GET /user/profile`
   - **Description**: Retrieves the logged-in user's profile.
   - **Response**:
     ```json
     {
     "_id": "67502ef05ce7e4ba2f593e2f",
     "username": "Peter",
     "role": "User",
     "name": "New User",
     "email": "not_provided@something.com",
     "age": 0,
     "experience": 0,
     "__v": 0
     }
     ```

2. **Update Own Profile**
   - **Endpoint**: `PUT /user/profile`
   - **Description**: Updates the logged-in user's profile.
   - **Request Body**:
     ```json
     {
      "name": "Peter Jarvis",
      "email": "peter11@gmail.com",
      "age": 24,
      "experience": 2
     }
     ```
   - **Response**:
     ```json
     {
       "_id": "67502ef05ce7e4ba2f593e2f",
      "username": "Peter",
      "role": "User",
      "name": "Peter Jarvis",
      "email": "peter11@gmail.com",
      "age": 24,
      "experience": 2,
      "__v": 0
     }
     ```

3. **View All Users** (Admin/Moderator only)
   - **Endpoint**: `GET /user/users`
   - **Description**: The User role will get access denied message on this. 
   - **Response**:
     ```json
     {
      "error": "Access denied."
     }
     ```
   - **In case of admin/moderator**:
     ```json
     [
     {
        "_id": "674f1734c3fa3ad70d9ee9c6",
        "username": "Admin",
        "role": "Admin",
        "name": "Alexender",
        "email": "alex12@gmail.com",
        "age": 24,
        "experience": 5,
        "__v": 0
     },

     {
        "_id": "674f25304756b3b6d1a9cdcd",
        "username": "Sunil",
        "role": "User",
        "name": "New User",
        "email": "not_provided@something.com",
        "age": 0,
        "experience": 0,
        "__v": 0
     },

     {
        "_id": "67502ef05ce7e4ba2f593e2f",
        "username": "Peter",
        "role": "User",
        "name": "Peter Jarvis",
        "email": "peter11@gmail.com",
        "age": 24,
        "experience": 2,
        "__v": 0
     }
     ] 
     ```

4. **Update User Role** (Admin only)
   - **Endpoint**: `PUT /user/users/:username/:role`
   - **Description**: Updates a user's role (Admin cannot modify another Admin).   Lets update the role of Peter to Moderator.(user/users/peter/moderator)
   - **Response**:
     ```json
     {
      "_id": "67502ef05ce7e4ba2f593e2f",
      "username": "Peter",
      "role": "Moderator",
      "name": "Peter Jarvis",
      "email": "peter11@gmail.com",
      "age": 24,
      "experience": 2,
      "__v": 0
     }
     ```

5. **Delete User** (Admin only)
   - **Endpoint**: `DELETE /user/users/:username`
   - **Description**: Deletes a user (Admin cannot delete another Admin). Lets delete Sunil from the database.(user/users/sunil)
   - **Response**:
     ```json
     {
       "message": "User deleted successfully."
     }
     ```

---

## Middleware

1. **Authentication Middleware**: 
   - Validates the JWT token from cookies to authenticate users.

2. **Role Authorization Middleware**:
   - Verifies if the logged-in user's role has the required permissions to access the endpoint.

---

## Testing Instructions
- Use an API Testing Tool
Use Postman, cURL, or any other API testing tool to test the endpoints.

- Signup using ```/auth/signup``` endpoint and 
authenticate using the ```/auth/login``` endpoint by providing valid credentials.

- Test Role-Based Access
  - User:
 Sign up and Log in as a standard user. The User role will be assigned to the new user by default.
Test access to endpoints like viewing and updating own profile.
Attempt restricted actions (e.g., deleting another user).
  - Admin:
Log in with admin credentials. If no admin is there currently then system creates a default admin by using default credentials
from .env file.
Test endpoints like viewing all users, updating user roles, and deleting users.

  - Moderator:
Log in as a moderator.
Test access to endpoints such as viewing all users.
Verify restricted actions like deleting or updating user roles.
  

